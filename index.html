<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Heist: Guard Escape</title>
  <link rel="stylesheet" href="css/style.css" type="text/css" />
  <style>
    .howto-popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .howto-popup.hidden { display: none; }
    .howto-popup-content {
      background: rgba(20,20,30,0.95);
      padding: 24px;
      border-radius: 10px;
      width: 420px;
      max-width: 90%;
      color: #fff;
    }
    .howto-close-btn {
      float: right;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
    }
    .howto-open-btn {
      margin-left: 8px;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #999;
      background: rgba(0, 0, 0, 0.4);
      color: #fff;
      cursor: pointer;
    }
    .howto-open-btn:hover {
      background: rgba(255,255,255,0.1);
    }
  </style>
</head>
<body class="hub-page">
  <video
    class="bg-video"
    src="assets/video/poster.mp4"
    autoplay
    muted
    loop
    playsinline
  ></video>

  <div class="hub-overlay">
    <div class="hub">
      <header class="hub-header">
        <div class="hub-title-block">
          <h1 id="hub-title">Neon Heist: Guard Escape</h1>
          <p class="subtitle" id="hub-subtitle">Stealth puzzle escape prototype</p>
        </div>
        <div class="lang-switch" aria-label="Language">
          <button class="lang-btn active" data-lang="vi" id="lang-vi">VI</button>
          <button class="lang-btn" data-lang="ko" id="lang-ko">KO</button>
          <button class="lang-btn" data-lang="en" id="lang-en">EN</button>
          <button id="howto-open" class="howto-open-btn">HOW TO PLAY</button>
        </div>
      </header>

      <main class="hub-main">
        <section class="stages">
          <div class="grid">
            <div class="card" id="stage1-card">
              <div class="card-thumb">
                <img src="assets/img/thumbnail1.png" alt="Stage 1 - Lab Escape thumbnail">
              </div>
              <div class="badge" id="stage1-badge">Stage 1</div>
              <h2 id="stage1-title">Lab Escape</h2>
              <p id="stage1-desc">
                Infiltrate the lab, hack the main console, and slip past the exit guards.
              </p>
              <div class="actions">
                <button id="stage1-btn">Play Stage 1</button>
              </div>
            </div>

            <div class="card" id="stage2-card">
              <div class="card-thumb">
                <img src="assets/img/thumbnail2.png" alt="Stage 2 - Security Breakout thumbnail">
              </div>
              <div class="badge locked" id="stage2-lock">LOCKED</div>
              <h2 id="stage2-title">Security Breakout</h2>
              <p id="stage2-desc">
                High-security wing with tighter patrols and new escape routes.
              </p>
              <div class="actions">
                <button id="stage2-btn" class="locked" disabled>Play Stage 2</button>
              </div>
            </div>

            <div class="card" id="stage3-card">
              <div class="card-thumb">
                <!-- Temporary thumbnail, you can replace the file later -->
                <img src="assets/img/thumbnail3.png" alt="Stage 3 - Core Infiltration thumbnail">
              </div>
              <div class="badge locked" id="stage3-lock">LOCKED</div>
              <h2 id="stage3-title">Core Infiltration</h2>
              <p id="stage3-desc">
                Dive into the inner core, bypass layered defenses, and escape with the final data.
              </p>
              <div class="actions">
                <button id="stage3-btn" class="locked" disabled>Play Stage 3</button>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <div id="howto-popup" class="howto-popup hidden">
    <div class="howto-popup-content">
      <button id="howto-close" class="howto-close-btn">×</button>

      <h2 id="howto-title"></h2>
      <p id="howto-intro"></p>

      <ul>
        <li id="howto-move"></li>
        <li id="howto-run"></li>
        <li id="howto-interact"></li>
        <li id="howto-decoy"></li>
        <li id="howto-alert"></li>
        <li id="howto-mission"></li>
      </ul>
    </div>
  </div>

  <script>
    (function () {
      // --- Simple language data for the hub only ---
      const HUB_TEXT = {
        vi: {
          title: "Neon Heist: Guard Escape",
          subtitle: "Prototype game hành động – ẩn nấp",
          heroTitle: "BẢN DÙNG THỬ NHIỆM VỤ ĐỘT NHẬP",
          heroText:
            "Lén lút xâm nhập, điều hướng lại hệ thống an ninh và trốn thoát khỏi cơ sở bảo vệ nghiêm ngặt.",
          stage1Badge: "Stage 1",
          stage1Title: "Lab Escape",
          stage1Desc:
            "Đột nhập tầng thí nghiệm, hack console chính và lẩn tránh lính gác để ra khỏi cửa thoát.",
          stage1Button: "Chơi Stage 1",
          stage2BadgeLocked: "LOCKED",
          stage2BadgeUnlocked: "UNLOCKED",
          stage2Title: "Security Breakout",
          stage2Desc:
            "Tầng an ninh chính với nhiều tuyến tuần tra và lộ trình trốn thoát phức tạp hơn.",
          stage2ButtonLocked: "Play Stage 2",
          stage2ButtonUnlocked: "Chơi Stage 2",
          stage3BadgeLocked: "LOCKED",
          stage3BadgeUnlocked: "UNLOCKED",
          stage3Title: "Core Infiltration",
          stage3Desc:
            "Đột nhập vào lõi trung tâm, bẻ khóa lớp bảo vệ cuối cùng và trốn thoát với dữ liệu tối mật.",
          stage3ButtonLocked: "Play Stage 3",
          stage3ButtonUnlocked: "Chơi Stage 3",
          howtoTitle: "Cách chơi",
          howtoIntro: "Tất cả màn chơi đều dùng chung một bộ điều khiển và quy tắc ẩn nấp.",
          howtoMove: "Di chuyển: phím mũi tên hoặc WASD.",
          howtoRun: "Chạy: giữ phím Shift khi di chuyển (tạo nhiều tiếng động và dễ bị phát hiện hơn).",
          howtoInteract: "Tương tác: phím E – dùng để hack console, bật/tắt công tắc, mở cửa.",
          howtoDecoy: "Mồi nhử: phím F – tạo tiếng động để dụ lính gác quay đầu (tùy màn).",
          howtoAlert: "Thanh cảnh báo: khi đầy, kẻ địch chuyển sang trạng thái truy đuổi. Tránh đứng trong vùng hình nón tầm nhìn.",
          howtoMission: "Mục tiêu chung: hack các console quan trọng, vô hiệu đủ bẫy và thoát qua cổng EXIT để hoàn thành màn."
        },
        ko: {
          title: "Neon Heist: Guard Escape",
          subtitle: "잠입 액션 스텔스 퍼즐 프로토타입",
          heroTitle: "침투 · 교란 · 탈출",
          heroText:
            "경비병과 감시 카메라가 지키는 하이테크 시설에 침투하고 보안 루트를 재구성하여 탈출하세요.",
          stage1Badge: "Stage 1",
          stage1Title: "Lab Escape",
          stage1Desc:
            "실험실 층에 잠입해 메인 콘솔을 해킹하고 경비를 피해 탈출구로 이동합니다.",
          stage1Button: "스테이지 1 시작",
          stage2BadgeLocked: "LOCKED",
          stage2BadgeUnlocked: "UNLOCKED",
          stage2Title: "Security Breakout",
          stage2Desc:
            "더 촘촘한 경비와 여러 탈출 루트가 있는 보안 구역 스테이지입니다.",
          stage2ButtonLocked: "Play Stage 2",
          stage2ButtonUnlocked: "스테이지 2 시작",
          stage3BadgeLocked: "LOCKED",
          stage3BadgeUnlocked: "UNLOCKED",
          stage3Title: "Core Infiltration",
          stage3Desc:
            "연구 시설의 심장부로 침투하여 마지막 보안 층을 돌파하고 데이터를 가지고 탈출하세요.",
          stage3ButtonLocked: "Play Stage 3",
          stage3ButtonUnlocked: "스테이지 3 시작",
          howtoTitle: "플레이 방법",
          howtoIntro: "모든 스테이지는 같은 조작과 잠입 규칙을 사용합니다.",
          howtoMove: "이동: 방향키 또는 WASD.",
          howtoRun: "달리기: 이동하면서 Shift 키를 누른 상태로 유지합니다. (소음이 커지고 발각 위험이 증가합니다.)",
          howtoInteract: "상호작용: E 키 – 콘솔 해킹, 스위치 조작, 문 열기 등에 사용합니다.",
          howtoDecoy: "미끼 장치: F 키 – 소리를 내서 경비의 시선을 다른 곳으로 돌립니다(스테이지에 따라 제공).",
          howtoAlert: "경계 게이지: 빨간 바가 가득 차면 적이 완전 추격 모드로 전환됩니다. 시야 콘 안에 오래 머무르지 마세요.",
          howtoMission: "기본 목표: 주요 콘솔을 해킹하고 함정을 충분히 비활성화한 뒤 EXIT 게이트까지 도달하면 스테이지를 클리어할 수 있습니다."
        },
        en: {
          title: "Neon Heist: Guard Escape",
          subtitle: "Stealth puzzle escape prototype",
          heroTitle: "STEALTH HEIST PROTOTYPE",
          heroText:
            "Infiltrate, reroute security, and escape from a high–tech facility guarded by patrols and cameras.",
          stage1Badge: "Stage 1",
          stage1Title: "Lab Escape",
          stage1Desc:
            "Infiltrate the lab, hack the main console, and slip past the exit guards.",
          stage1Button: "Play Stage 1",
          stage2BadgeLocked: "LOCKED",
          stage2BadgeUnlocked: "UNLOCKED",
          stage2Title: "Security Breakout",
          stage2Desc:
            "High-security wing with tighter patrols and new escape routes.",
          stage2ButtonLocked: "Play Stage 2",
          stage2ButtonUnlocked: "Play Stage 2",
          stage3BadgeLocked: "LOCKED",
          stage3BadgeUnlocked: "UNLOCKED",
          stage3Title: "Core Infiltration",
          stage3Desc:
            "Dive into the inner core, bypass layered defenses, and escape with the final data.",
          stage3ButtonLocked: "Play Stage 3",
          stage3ButtonUnlocked: "Play Stage 3",
          howtoTitle: "How to Play",
          howtoIntro: "All stages share the same basic controls and stealth rules.",
          howtoMove: "Move: Arrow keys or WASD.",
          howtoRun: "Run: Hold Shift while moving (louder and easier to detect).",
          howtoInteract: "Interact: E key – hack consoles, flip switches, open doors.",
          howtoDecoy: "Decoy: F key – drop a noise decoy to lure guards (available in some stages).",
          howtoAlert: "Alert level: when the red bar fills, enemies enter full chase mode. Avoid staying inside their vision cones.",
          howtoMission: "Main objective: hack key consoles, disable enough traps, then reach the EXIT gate to clear the stage."
        }
      };

      const titleEl = document.getElementById("hub-title");
      const subtitleEl = document.getElementById("hub-subtitle");
      const heroTitleEl = document.getElementById("hero-title");
      const heroTextEl = document.getElementById("hero-text");
      const stage1BadgeEl = document.getElementById("stage1-badge");
      const stage1TitleEl = document.getElementById("stage1-title");
      const stage1DescEl = document.getElementById("stage1-desc");
      const stage1BtnEl = document.getElementById("stage1-btn");
      const stage2LockEl = document.getElementById("stage2-lock");
      const stage2TitleEl = document.getElementById("stage2-title");
      const stage2DescEl = document.getElementById("stage2-desc");
      const stage2BtnEl = document.getElementById("stage2-btn");
      const stage3LockEl = document.getElementById("stage3-lock");
      const stage3TitleEl = document.getElementById("stage3-title");
      const stage3DescEl = document.getElementById("stage3-desc");
      const stage3BtnEl = document.getElementById("stage3-btn");
      const howtoOpenBtn = document.getElementById("howto-open");
      const howtoPopup = document.getElementById("howto-popup");
      const howtoCloseBtn = document.getElementById("howto-close");
      const howtoTitleEl = document.getElementById("howto-title");
      const howtoIntroEl = document.getElementById("howto-intro");
      const howtoMoveEl = document.getElementById("howto-move");
      const howtoRunEl = document.getElementById("howto-run");
      const howtoInteractEl = document.getElementById("howto-interact");
      const howtoDecoyEl = document.getElementById("howto-decoy");
      const howtoAlertEl = document.getElementById("howto-alert");
      const howtoMissionEl = document.getElementById("howto-mission");

      const langButtons = document.querySelectorAll(".lang-btn");

      function isStage2Unlocked() {
        try {
          return localStorage.getItem("stage1_cleared") === "true";
        } catch (e) {
          return false;
        }
      }

      function isStage3Unlocked() {
        try {
          return localStorage.getItem("stage2_cleared") === "true";
        } catch (e) {
          return false;
        }
      }

      function applyLang(lang) {
        const t = HUB_TEXT[lang] || HUB_TEXT.en;
        if (titleEl) titleEl.textContent = t.title;
        if (subtitleEl) subtitleEl.textContent = t.subtitle;
        if (heroTitleEl) heroTitleEl.textContent = t.heroTitle;
        if (heroTextEl) heroTextEl.textContent = t.heroText;
        if (stage1BadgeEl) stage1BadgeEl.textContent = t.stage1Badge;
        if (stage1TitleEl) stage1TitleEl.textContent = t.stage1Title;
        if (stage1DescEl) stage1DescEl.textContent = t.stage1Desc;
        if (stage1BtnEl) stage1BtnEl.textContent = t.stage1Button;

        const stage2Unlocked = isStage2Unlocked();
        if (stage2LockEl) {
          stage2LockEl.textContent = stage2Unlocked
            ? t.stage2BadgeUnlocked
            : t.stage2BadgeLocked;
        }
        if (stage2TitleEl) stage2TitleEl.textContent = t.stage2Title;
        if (stage2DescEl) stage2DescEl.textContent = t.stage2Desc;
        if (stage2BtnEl) {
          stage2BtnEl.textContent = stage2Unlocked
            ? t.stage2ButtonUnlocked
            : t.stage2ButtonLocked;
        }

        const stage3Unlocked = isStage3Unlocked();
        if (stage3LockEl) {
          stage3LockEl.textContent = stage3Unlocked
            ? t.stage3BadgeUnlocked
            : t.stage3BadgeLocked;
          stage3LockEl.classList.toggle("locked", !stage3Unlocked);
        }
        if (stage3TitleEl) stage3TitleEl.textContent = t.stage3Title;
        if (stage3DescEl) stage3DescEl.textContent = t.stage3Desc;
        if (stage3BtnEl) {
          stage3BtnEl.textContent = stage3Unlocked
            ? t.stage3ButtonUnlocked
            : t.stage3ButtonLocked;
          stage3BtnEl.disabled = !stage3Unlocked;
          stage3BtnEl.classList.toggle("locked", !stage3Unlocked);
        }

        if (howtoTitleEl) howtoTitleEl.textContent = t.howtoTitle;
        if (howtoIntroEl) howtoIntroEl.textContent = t.howtoIntro;
        if (howtoMoveEl) howtoMoveEl.textContent = t.howtoMove;
        if (howtoRunEl) howtoRunEl.textContent = t.howtoRun;
        if (howtoInteractEl) howtoInteractEl.textContent = t.howtoInteract;
        if (howtoDecoyEl) howtoDecoyEl.textContent = t.howtoDecoy;
        if (howtoAlertEl) howtoAlertEl.textContent = t.howtoAlert;
        if (howtoMissionEl) howtoMissionEl.textContent = t.howtoMission;

        langButtons.forEach(function (btn) {
          btn.classList.toggle("active", btn.dataset.lang === lang);
        });

        document.documentElement.lang = lang;
        try {
          localStorage.setItem("hub_lang", lang);
        } catch (e) {}
      }

      // Stage navigation & unlock logic
      if (stage1BtnEl) {
        stage1BtnEl.addEventListener("click", function () {
          window.location.href = "stage1.html";
        });
      }

      const stage2Unlocked = isStage2Unlocked();
      if (stage2Unlocked) {
        if (stage2LockEl) {
          stage2LockEl.classList.remove("locked");
        }
        if (stage2BtnEl) {
          stage2BtnEl.classList.remove("locked");
          stage2BtnEl.disabled = false;
          stage2BtnEl.addEventListener("click", function () {
            window.location.href = "stage2.html";
          });
        }
      } else {
        if (stage2BtnEl) {
          stage2BtnEl.disabled = true;
        }
      }

      const stage3Unlocked = isStage3Unlocked();
      if (stage3Unlocked) {
        if (stage3LockEl) {
          stage3LockEl.classList.remove("locked");
        }
        if (stage3BtnEl) {
          stage3BtnEl.classList.remove("locked");
          stage3BtnEl.disabled = false;
          stage3BtnEl.addEventListener("click", function () {
            window.location.href = "stage3.html";
          });
        }
      } else {
        if (stage3BtnEl) {
          stage3BtnEl.disabled = true;
        }
      }

      // Language button events
      langButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          const lang = btn.dataset.lang;
          applyLang(lang);
        });
      });

      if (howtoOpenBtn) {
        howtoOpenBtn.addEventListener("click", function () {
          if (howtoPopup) {
            howtoPopup.classList.remove("hidden");
          }
        });
      }

      if (howtoCloseBtn) {
        howtoCloseBtn.addEventListener("click", function () {
          if (howtoPopup) {
            howtoPopup.classList.add("hidden");
          }
        });
      }

      if (howtoPopup) {
        howtoPopup.addEventListener("click", function (e) {
          if (e.target === howtoPopup) {
            howtoPopup.classList.add("hidden");
          }
        });
      }

      // Initial language
      let initialLang = "ko";
      try {
        const stored = localStorage.getItem("hub_lang");
        if (stored && HUB_TEXT[stored]) {
          initialLang = stored;
        }
      } catch (e) {}

      applyLang(initialLang);
    })();
  </script>
</body>
</html>
